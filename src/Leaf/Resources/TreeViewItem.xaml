<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:system="clr-namespace:System;assembly=System.Runtime">
  <system:Double x:Key="TreeViewItemChevronSize">10</system:Double>
  <system:Double x:Key="TreeViewItemFontSize">14</system:Double>
  <system:String x:Key="TreeViewChevronRightGlyph">&#xE76C;</system:String>
  <system:String x:Key="TreeViewChevronLeftGlyph">&#xE76B;</system:String>

  <Style x:Key="ExpandCollapseToggleButtonStyle" TargetType="{x:Type ToggleButton}">
    <Setter Property="FocusVisualStyle" Value="{x:Null}" />
    <Setter Property="Focusable" Value="False" />
    <Setter Property="OverridesDefaultStyle" Value="True" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type ToggleButton}">
          <Grid Name="ChevronContainer" Width="15" Height="15" Background="Transparent" RenderTransformOrigin="0.5, 0.5">
            <Grid.RenderTransform>
              <RotateTransform Angle="0" />
            </Grid.RenderTransform>
            <TextBlock Name="ChevronIcon"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Center"
                       FontFamily="{DynamicResource SymbolThemeFontFamily}"
                       FontSize="{StaticResource TreeViewItemChevronSize}"
                       Text="{StaticResource TreeViewChevronRightGlyph}" />
          </Grid>
          <ControlTemplate.Triggers>
            <Trigger Property="FlowDirection" Value="RightToLeft">
              <Setter TargetName="ChevronIcon" Property="Text" Value="{StaticResource TreeViewChevronLeftGlyph}" />
            </Trigger>
            <Trigger Property="IsChecked" Value="True">
              <Trigger.EnterActions>
                <BeginStoryboard>
                  <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="ChevronContainer"
                                     Storyboard.TargetProperty="(Grid.RenderTransform).(RotateTransform.Angle)"
                                     To="90" Duration="0:0:0.16" />
                  </Storyboard>
                </BeginStoryboard>
              </Trigger.EnterActions>
              <Trigger.ExitActions>
                <BeginStoryboard>
                  <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="ChevronContainer"
                                     Storyboard.TargetProperty="(Grid.RenderTransform).(RotateTransform.Angle)"
                                     To="0" Duration="0:0:0.16" />
                  </Storyboard>
                </BeginStoryboard>
              </Trigger.ExitActions>
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>

  <Style x:Key="DefaultTreeViewItemStyle" TargetType="{x:Type TreeViewItem}">
    <Setter Property="FocusVisualStyle" Value="{x:Null}" />
    <Setter Property="Foreground" Value="{DynamicResource TreeViewItemForeground}" />
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="Margin" Value="0" />
    <Setter Property="Padding" Value="4,2" />
    <Setter Property="BorderThickness" Value="0" />
    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    <Setter Property="VerticalContentAlignment" Value="Center" />
    <Setter Property="IsTabStop" Value="True" />
    <Setter Property="OverridesDefaultStyle" Value="True" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type TreeViewItem}">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Full-width highlight border with rounded corners -->
            <Border x:Name="HighlightBorder"
                    Grid.Row="0"
                    Background="Transparent"
                    CornerRadius="{DynamicResource ControlCornerRadius}"
                    Margin="0,1">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" MinWidth="19" />
                  <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Selection indicator bar (only shown when selected) -->
                <Rectangle x:Name="ActiveRectangle"
                           Grid.Column="0"
                           Width="3" Height="16"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           Fill="#28A745"
                           RadiusX="2" RadiusY="2"
                           Visibility="Collapsed" />

                <!-- Expander button -->
                <ToggleButton x:Name="Expander"
                              Grid.Column="0"
                              Margin="8,0"
                              ClickMode="Press"
                              Style="{StaticResource ExpandCollapseToggleButtonStyle}"
                              IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}" />

                <!-- Content -->
                <ContentPresenter x:Name="PART_Header"
                                  Grid.Column="1"
                                  Margin="{TemplateBinding Padding}"
                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                  ContentSource="Header"
                                  TextElement.FontSize="{TemplateBinding FontSize}" />
              </Grid>
            </Border>

            <!-- Child items container -->
            <ItemsPresenter x:Name="ItemsHost"
                            Grid.Row="1"
                            Margin="19,0,0,0"
                            Visibility="Collapsed" />
          </Grid>
          <ControlTemplate.Triggers>
            <Trigger Property="HasItems" Value="False">
              <Setter TargetName="Expander" Property="Visibility" Value="Hidden" />
            </Trigger>
            <Trigger Property="IsExpanded" Value="True">
              <Setter TargetName="ItemsHost" Property="Visibility" Value="Visible" />
            </Trigger>
            <Trigger Property="IsMouseOver" Value="True" SourceName="HighlightBorder">
              <Setter TargetName="HighlightBorder" Property="Background" Value="{DynamicResource LeafAccentHoverBrush}" />
            </Trigger>
            <Trigger Property="IsSelected" Value="True">
              <Setter TargetName="HighlightBorder" Property="Background" Value="{DynamicResource LeafAccentSelectedBrush}" />
              <Setter TargetName="ActiveRectangle" Property="Visibility" Value="Visible" />
            </Trigger>
            <MultiTrigger>
              <MultiTrigger.Conditions>
                <Condition Property="IsSelected" Value="True" />
                <Condition Property="IsSelectionActive" Value="False" />
              </MultiTrigger.Conditions>
              <Setter TargetName="HighlightBorder" Property="Background" Value="{DynamicResource LeafAccentSelectedBrush}" />
              <Setter TargetName="ActiveRectangle" Property="Visibility" Value="Visible" />
            </MultiTrigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
    <Style.Triggers>
      <Trigger Property="VirtualizingPanel.IsVirtualizing" Value="True">
        <Setter Property="ItemsPanel">
          <Setter.Value>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel />
            </ItemsPanelTemplate>
          </Setter.Value>
        </Setter>
      </Trigger>
    </Style.Triggers>
  </Style>

  <Style x:Key="{x:Type TreeViewItem}" BasedOn="{StaticResource DefaultTreeViewItemStyle}" TargetType="{x:Type TreeViewItem}" />
</ResourceDictionary>
