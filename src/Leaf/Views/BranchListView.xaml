<UserControl
    x:Class="Leaf.Views.BranchListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Leaf.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ic="clr-namespace:FluentIcons.Wpf;assembly=FluentIcons.Wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:Leaf.Models"
    d:DesignHeight="450"
    d:DesignWidth="200"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:NullToVisibilityInverseConverter x:Key="NullToVisibilityInverseConverter" />
        <converters:BranchCategoryItemsConverter x:Key="BranchCategoryItemsConverter" />
        <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <converters:BranchNameToGitFlowColorConverter x:Key="BranchNameToGitFlowColorConverter" />
        <converters:BranchNameToGitFlowVisibilityConverter x:Key="BranchNameToGitFlowVisibilityConverter" />
        <converters:GitFlowTypeToVisibilityConverter x:Key="GitFlowTypeToVisibilityConverter" />
        <converters:StringIsNullOrEmptyConverter x:Key="StringIsNullOrEmptyConverter" />
        <converters:BoolToDetachedTextConverter x:Key="BoolToDetachedTextConverter" />

        <!--  Multi-select TreeViewItem style for BranchInfo items  -->
        <!--  NOTE: Does NOT use TreeViewItem.IsSelected triggers to avoid single-selection enforcement  -->
        <!--  Selection visuals are driven by DataTrigger on DataContext.IsSelected instead  -->
        <Style x:Key="MultiSelectBranchTreeViewItemStyle" TargetType="{x:Type TreeViewItem}">
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="Foreground" Value="{DynamicResource TreeViewItemForeground}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="IsTabStop" Value="True" />
            <Setter Property="OverridesDefaultStyle" Value="True" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay, FallbackValue=False}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TreeViewItem}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!--  Full-width highlight border  -->
                            <Border
                                x:Name="HighlightBorder"
                                Grid.Row="0"
                                Margin="0,1"
                                CornerRadius="{DynamicResource ControlCornerRadius}">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource LeafAccentHoverBrush}" />
                                            </Trigger>
                                            <!--  Use DataContext.IsSelected for multi-select visual  -->
                                            <!--  FallbackValue=False prevents errors for BranchCategory/RemoteBranchGroup items  -->
                                            <DataTrigger Binding="{Binding IsSelected, FallbackValue=False}" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource LeafAccentSelectedBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" MinWidth="19" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Selection indicator bar  -->
                                    <Rectangle
                                        x:Name="ActiveRectangle"
                                        Grid.Column="0"
                                        Width="3"
                                        Height="16"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Fill="#28A745"
                                        RadiusX="2"
                                        RadiusY="2"
                                        Visibility="{Binding IsSelected, FallbackValue=Collapsed, Converter={StaticResource BoolToVisibilityConverter}}" />

                                    <!--  Expander button  -->
                                    <ToggleButton
                                        x:Name="Expander"
                                        Grid.Column="0"
                                        Margin="8,0"
                                        ClickMode="Press"
                                        IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                        Style="{StaticResource ExpandCollapseToggleButtonStyle}" />

                                    <!--  Content  -->
                                    <ContentPresenter
                                        x:Name="PART_Header"
                                        Grid.Column="1"
                                        Margin="{TemplateBinding Padding}"
                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                        ContentSource="Header"
                                        TextElement.FontSize="{TemplateBinding FontSize}" />
                                </Grid>
                            </Border>

                            <!--  Child items container  -->
                            <ItemsPresenter
                                x:Name="ItemsHost"
                                Grid.Row="1"
                                Margin="19,0,0,0"
                                Visibility="Collapsed" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="Expander" Property="Visibility" Value="Hidden" />
                            </Trigger>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ItemsHost" Property="Visibility" Value="Visible" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <TextBlock
            Grid.Row="0"
            Margin="12,12,12,8"
            FontSize="11"
            FontWeight="SemiBold"
            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
            Text="{Binding SelectedRepository.Name, FallbackValue='BRANCHES'}"
            TextTrimming="CharacterEllipsis" />

        <!--  No repo selected message  -->
        <TextBlock
            Grid.Row="1"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
            Text="Select a repository to view branches"
            Visibility="{Binding SelectedRepository, Converter={StaticResource NullToVisibilityInverseConverter}}" />

        <!--  Branch tree  -->
        <TreeView
            x:Name="BranchTreeView"
            Grid.Row="1"
            Padding="4"
            BorderThickness="0"
            ItemsSource="{Binding SelectedRepository.BranchCategories}"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
            Visibility="{Binding SelectedRepository, Converter={StaticResource NullToVisibilityConverter}}">
            <TreeView.Resources>
                <!--  Branch category template (LOCAL/REMOTE/GITFLOW)  -->
                <HierarchicalDataTemplate DataType="{x:Type models:BranchCategory}" ItemsSource="{Binding Converter={StaticResource BranchCategoryItemsConverter}}">
                    <Grid Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <Grid.ContextMenu>
                            <ContextMenu>
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.ClearBranchFiltersCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    Header="Show all branches"
                                    Visibility="{Binding PlacementTarget.Tag.IsBranchFilterActive, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                <!--  Remote category specific items  -->
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.AddRemoteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    Header="Add Remote..."
                                    Visibility="{Binding IsRemoteCategory, Converter={StaticResource BoolToVisibilityConverter}}" />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.FetchAllRemotesCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    Header="Fetch All Remotes"
                                    Visibility="{Binding IsRemoteCategory, Converter={StaticResource BoolToVisibilityConverter}}" />
                            </ContextMenu>
                        </Grid.ContextMenu>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel
                            Grid.Column="0"
                            Margin="0,4"
                            Orientation="Horizontal">
                            <ic:SymbolIcon
                                x:Name="CategoryIcon"
                                Margin="0,0,6,0"
                                VerticalAlignment="Center"
                                FontSize="12"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                IconVariant="Regular"
                                Symbol="BranchFork" />
                            <TextBlock
                                x:Name="CategoryName"
                                VerticalAlignment="Center"
                                FontSize="11"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Text="{Binding Name}" />
                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="11"
                                Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                Text="{Binding BranchCount, StringFormat=' ({0})'}" />
                        </StackPanel>
                        <!--  GitFlow action button  -->
                        <Button
                            x:Name="GitFlowActionButton"
                            Grid.Column="1"
                            Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                            Margin="0"
                            Padding="0"
                            VerticalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="GitFlowActionButton_Click"
                            Cursor="Hand"
                            Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            ToolTip="GitFlow actions"
                            Visibility="Collapsed">
                            <ic:SymbolIcon
                                FontSize="10"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Symbol="ChevronRight" />
                            <Button.ContextMenu>
                                <ContextMenu />
                            </Button.ContextMenu>
                        </Button>
                        <!--  Add Branch button (LOCAL category)  -->
                        <Button
                            x:Name="AddBranchButton"
                            Grid.Column="1"
                            Margin="0"
                            Padding="4"
                            VerticalAlignment="Center"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="AddBranchButton_Click"
                            Cursor="Hand"
                            ToolTip="Create new branch"
                            Visibility="Collapsed">
                            <ic:SymbolIcon
                                FontSize="12"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Symbol="Add" />
                        </Button>
                        <!--  Add Remote button (REMOTE category)  -->
                        <Button
                            x:Name="AddRemoteButton"
                            Grid.Column="1"
                            Margin="0"
                            Padding="4"
                            VerticalAlignment="Center"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Command="{Binding DataContext.AddRemoteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Cursor="Hand"
                            ToolTip="Add remote"
                            Visibility="Collapsed">
                            <ic:SymbolIcon
                                FontSize="12"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Symbol="Add" />
                        </Button>
                        <!--  Add Worktree button (WORKTREES category)  -->
                        <Button
                            x:Name="AddWorktreeButton"
                            Grid.Column="1"
                            Margin="0"
                            Padding="4"
                            VerticalAlignment="Center"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="AddWorktreeButton_Click"
                            Cursor="Hand"
                            ToolTip="Create worktree"
                            Visibility="Collapsed">
                            <ic:SymbolIcon
                                FontSize="12"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Symbol="Add" />
                        </Button>
                    </Grid>
                    <HierarchicalDataTemplate.Triggers>
                        <DataTrigger Binding="{Binding IsGitFlowCategory}" Value="True">
                            <Setter TargetName="CategoryIcon" Property="Symbol" Value="Flow" />
                            <Setter TargetName="CategoryIcon" Property="Foreground" Value="#10B981" />
                            <Setter TargetName="CategoryName" Property="Foreground" Value="#10B981" />
                            <Setter TargetName="GitFlowActionButton" Property="Visibility" Value="Visible" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsTagsCategory}" Value="True">
                            <Setter TargetName="CategoryIcon" Property="Symbol" Value="Tag" />
                            <Setter TargetName="CategoryIcon" Property="Foreground" Value="#F59E0B" />
                            <Setter TargetName="CategoryName" Property="Foreground" Value="#F59E0B" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsLocalCategory}" Value="True">
                            <Setter TargetName="AddBranchButton" Property="Visibility" Value="Visible" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsRemoteCategory}" Value="True">
                            <Setter TargetName="AddRemoteButton" Property="Visibility" Value="Visible" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsWorktreesCategory}" Value="True">
                            <Setter TargetName="CategoryIcon" Property="Symbol" Value="TreeDeciduous" />
                            <Setter TargetName="CategoryIcon" Property="Foreground" Value="#3B82F6" />
                            <Setter TargetName="CategoryName" Property="Foreground" Value="#3B82F6" />
                            <Setter TargetName="AddWorktreeButton" Property="Visibility" Value="Visible" />
                        </DataTrigger>
                    </HierarchicalDataTemplate.Triggers>
                </HierarchicalDataTemplate>

                <!--  Remote branch group template (origin, upstream, etc.)  -->
                <HierarchicalDataTemplate DataType="{x:Type models:RemoteBranchGroup}" ItemsSource="{Binding Branches}">
                    <Border Background="Transparent" Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <Border.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding PlacementTarget.Tag.FetchRemoteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding Name}">
                                    <MenuItem.Header>
                                        <TextBlock>
                                            <Run Text="Fetch " /><Run Text="{Binding Name, Mode=OneWay}" />
                                        </TextBlock>
                                    </MenuItem.Header>
                                </MenuItem>
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.EditRemoteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Edit Remote..." />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.RemoveRemoteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding Name}"
                                    Foreground="#DC2626"
                                    Header="Remove Remote" />
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.SetDefaultRemoteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding Name}"
                                    Header="Set as Default" />
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.CopyRemoteUrlCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding Url}"
                                    Header="Copy URL" />
                            </ContextMenu>
                        </Border.ContextMenu>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Margin="0,2" Orientation="Horizontal">
                                <!--  GitHub icon  -->
                                <Viewbox
                                    x:Name="GitHubIcon"
                                    Width="11"
                                    Height="11"
                                    Margin="0,0,6,0"
                                    VerticalAlignment="Center"
                                    Visibility="Collapsed">
                                    <Path Style="{StaticResource GitHubLogoPath}" />
                                </Viewbox>
                                <!--  Azure DevOps icon  -->
                                <Viewbox
                                    x:Name="AzureIcon"
                                    Width="11"
                                    Height="11"
                                    Margin="0,0,6,0"
                                    VerticalAlignment="Center"
                                    Visibility="Collapsed">
                                    <Path Style="{StaticResource AzureDevOpsLogoPath}" />
                                </Viewbox>
                                <!--  Cloud icon (fallback)  -->
                                <ic:SymbolIcon
                                    x:Name="CloudIcon"
                                    Margin="0,0,6,0"
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                    IconVariant="Regular"
                                    Symbol="Cloud" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                    Text="{Binding Name}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                    Text=" (" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                    Text="{Binding ServiceDisplayName}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                    Text=")" />
                            </StackPanel>

                            <!--  Default remote indicator  -->
                            <ic:SymbolIcon
                                Grid.Column="1"
                                Margin="4,0,4,0"
                                VerticalAlignment="Center"
                                FontSize="10"
                                Foreground="#10B981"
                                IconVariant="Regular"
                                Symbol="Checkmark"
                                ToolTip="Default remote"
                                Visibility="{Binding IsDefault, Converter={StaticResource BoolToVisibilityConverter}}" />
                        </Grid>
                    </Border>
                    <HierarchicalDataTemplate.Triggers>
                        <DataTrigger Binding="{Binding RemoteType}" Value="GitHub">
                            <Setter TargetName="GitHubIcon" Property="Visibility" Value="Visible" />
                            <Setter TargetName="CloudIcon" Property="Visibility" Value="Collapsed" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding RemoteType}" Value="AzureDevOps">
                            <Setter TargetName="AzureIcon" Property="Visibility" Value="Visible" />
                            <Setter TargetName="CloudIcon" Property="Visibility" Value="Collapsed" />
                        </DataTrigger>
                    </HierarchicalDataTemplate.Triggers>
                </HierarchicalDataTemplate>

                <!--  Branch template  -->
                <DataTemplate DataType="{x:Type models:BranchInfo}">
                    <Border
                        x:Name="BranchBorder"
                        Padding="2,3"
                        Background="Transparent"
                        CornerRadius="2"
                        Cursor="Hand"
                        MouseLeftButtonDown="Branch_MouseLeftButtonDown"
                        MouseRightButtonDown="Branch_MouseRightButtonDown"
                        Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <Border.ContextMenu>
                            <ContextMenu>
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.CheckoutBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Checkout" />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.PullBranchFastForwardCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Pull (fast-forward if possible)" />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.PushBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Push"
                                    IsEnabled="{Binding IsRemote, Converter={StaticResource InverseBoolConverter}}" />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.SetUpstreamCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Set upstream">
                                    <MenuItem.Style>
                                        <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                            <Setter Property="IsEnabled" Value="True" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsRemote}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TrackingBranchName, Converter={StaticResource StringIsNullOrEmptyConverter}}" Value="False">
                                                    <Setter Property="IsEnabled" Value="False" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </MenuItem.Style>
                                </MenuItem>
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.MergeBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Merge into current branch"
                                    IsEnabled="{Binding IsCurrent, Converter={StaticResource InverseBoolConverter}}" />
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.CreateBranchAtBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Create branch here..." />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.CreateWorktreeForBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Create worktree..."
                                    IsEnabled="{Binding IsRemote, Converter={StaticResource InverseBoolConverter}}" />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.RenameBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Rename branch..."
                                    IsEnabled="{Binding IsRemote, Converter={StaticResource InverseBoolConverter}}" />
                                <MenuItem Header="GitFlow" Visibility="{Binding GitFlowType, Converter={StaticResource GitFlowTypeToVisibilityConverter}, ConverterParameter=Finishable}">
                                    <MenuItem
                                        Command="{Binding PlacementTarget.Tag.FinishGitFlowBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                        CommandParameter="{Binding}"
                                        Header="Finish Branch" />
                                    <MenuItem
                                        Command="{Binding PlacementTarget.Tag.PublishGitFlowBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                        CommandParameter="{Binding}"
                                        Header="Publish Branch" />
                                </MenuItem>
                                <Separator />
                                <MenuItem Command="{Binding PlacementTarget.Tag.ToggleHideBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding}">
                                    <MenuItem.Style>
                                        <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                            <Setter Property="Header" Value="Hide from graph" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsHidden}" Value="True">
                                                    <Setter Property="Header" Value="Show in graph" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </MenuItem.Style>
                                </MenuItem>
                                <MenuItem Command="{Binding PlacementTarget.Tag.ToggleSoloBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding}">
                                    <MenuItem.Style>
                                        <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                            <Setter Property="Header" Value="Solo in graph" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSolo}" Value="True">
                                                    <Setter Property="Header" Value="Clear solo" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </MenuItem.Style>
                                </MenuItem>
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.DeleteBranchCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Foreground="#DC2626"
                                    Header="Delete" />
                            </ContextMenu>
                        </Border.ContextMenu>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <!--  Current branch indicator (fixed width for alignment)  -->
                                <Grid Width="14" Margin="0,0,2,0">
                                    <ic:SymbolIcon
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="10"
                                        Foreground="#10B981"
                                        IconVariant="Regular"
                                        Symbol="Checkmark"
                                        Visibility="{Binding IsCurrent, Converter={StaticResource BoolToVisibilityConverter}}" />
                                </Grid>

                                <!--  GitFlow type indicator (colored dot)  -->
                                <Border
                                    Width="6"
                                    Height="6"
                                    Margin="0,0,4,0"
                                    VerticalAlignment="Center"
                                    Background="{Binding GitFlowColor}"
                                    CornerRadius="3"
                                    Visibility="{Binding GitFlowType, Converter={StaticResource GitFlowTypeToVisibilityConverter}}" />

                                <!--  Branch icon  -->
                                <ic:SymbolIcon
                                    Margin="0,0,6,0"
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                    IconVariant="Regular"
                                    Symbol="Branch" />

                                <!--  Branch name  -->
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="11"
                                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                    Text="{Binding Name}" />
                            </StackPanel>

                            <StackPanel
                                Grid.Column="1"
                                Margin="6,0,0,0"
                                VerticalAlignment="Center"
                                Orientation="Horizontal">
                                <Border
                                    Margin="0,0,4,0"
                                    Padding="4,1"
                                    Background="{DynamicResource LeafAccentSubtleBrush}"
                                    CornerRadius="6"
                                    ToolTip="Soloed in graph"
                                    Visibility="{Binding IsSolo, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock
                                        FontSize="9"
                                        FontWeight="SemiBold"
                                        Foreground="#28A745"
                                        Text="SOLO" />
                                </Border>
                                <Border
                                    Padding="4,1"
                                    Background="#1A64748B"
                                    CornerRadius="6"
                                    ToolTip="Hidden in graph"
                                    Visibility="{Binding IsHidden, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock
                                        FontSize="9"
                                        FontWeight="SemiBold"
                                        Foreground="#64748B"
                                        Text="HIDE" />
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>

                <!--  Tag template  -->
                <DataTemplate DataType="{x:Type models:TagInfo}">
                    <Border
                        x:Name="TagBorder"
                        Padding="2,3"
                        Background="Transparent"
                        CornerRadius="2"
                        Cursor="Hand"
                        MouseLeftButtonDown="Tag_MouseLeftButtonDown"
                        MouseRightButtonDown="Tag_MouseRightButtonDown"
                        Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <Border.ContextMenu>
                            <ContextMenu>
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.CheckoutTagCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Checkout (detached HEAD)" />
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.DeleteTagCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Foreground="#DC2626"
                                    Header="Delete" />
                            </ContextMenu>
                        </Border.ContextMenu>
                        <StackPanel Orientation="Horizontal">
                            <!--  Tag icon  -->
                            <ic:SymbolIcon
                                Margin="0,0,6,0"
                                VerticalAlignment="Center"
                                FontSize="11"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                IconVariant="Regular"
                                Symbol="Tag" />

                            <!--  Tag name  -->
                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="11"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Text="{Binding Name}" />

                            <!--  Annotated tag indicator  -->
                            <ic:SymbolIcon
                                Margin="4,0,0,0"
                                VerticalAlignment="Center"
                                FontSize="8"
                                Foreground="#F59E0B"
                                IconVariant="Filled"
                                Symbol="Star"
                                ToolTip="Annotated tag"
                                Visibility="{Binding IsAnnotated, Converter={StaticResource BoolToVisibilityConverter}}" />
                        </StackPanel>
                    </Border>
                </DataTemplate>

                <!--  Worktree template  -->
                <DataTemplate DataType="{x:Type models:WorktreeInfo}">
                    <Border
                        x:Name="WorktreeBorder"
                        Padding="2,3"
                        HorizontalAlignment="Stretch"
                        Background="Transparent"
                        CornerRadius="2"
                        Cursor="Hand"
                        MouseLeftButtonDown="Worktree_MouseLeftButtonDown"
                        MouseRightButtonDown="Worktree_MouseRightButtonDown"
                        Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <Border.ContextMenu>
                            <ContextMenu>
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.SwitchToWorktreeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Switch to Worktree"
                                    IsEnabled="{Binding IsCurrent, Converter={StaticResource InverseBoolConverter}}" />
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.LockWorktreeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Lock">
                                    <MenuItem.Style>
                                        <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                            <Setter Property="IsEnabled" Value="True" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLocked}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsMainWorktree}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </MenuItem.Style>
                                </MenuItem>
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.UnlockWorktreeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Unlock"
                                    IsEnabled="{Binding IsLocked}" />
                                <Separator />
                                <MenuItem Command="{Binding PlacementTarget.Tag.PruneWorktreesCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Header="Prune Stale References" />
                                <Separator />
                                <MenuItem
                                    Command="{Binding PlacementTarget.Tag.RemoveWorktreeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                    CommandParameter="{Binding}"
                                    Header="Remove">
                                    <MenuItem.Style>
                                        <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                            <Setter Property="Foreground" Value="#DC2626" />
                                            <Setter Property="IsEnabled" Value="True" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsMainWorktree}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False" />
                                                    <Setter Property="Foreground" Value="{DynamicResource TextFillColorDisabledBrush}" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False" />
                                                    <Setter Property="Foreground" Value="{DynamicResource TextFillColorDisabledBrush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </MenuItem.Style>
                                </MenuItem>
                            </ContextMenu>
                        </Border.ContextMenu>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="16" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!--  Current worktree indicator (fixed width for alignment)  -->
                            <ic:SymbolIcon
                                Grid.Column="0"
                                Margin="0,0,4,0"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontSize="10"
                                Foreground="#10B981"
                                IconVariant="Regular"
                                Symbol="Checkmark"
                                ToolTip="Current worktree"
                                Visibility="{Binding IsCurrent, Converter={StaticResource BoolToVisibilityConverter}}" />

                            <!--  Worktree icon  -->
                            <ic:SymbolIcon
                                Grid.Column="1"
                                Margin="0,0,6,0"
                                VerticalAlignment="Center"
                                FontSize="11"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                IconVariant="Regular"
                                Symbol="TreeDeciduous" />

                            <!--  Worktree name and branch info (truncates when narrow)  -->
                            <TextBlock
                                Grid.Column="2"
                                VerticalAlignment="Center"
                                FontSize="11"
                                TextTrimming="CharacterEllipsis"
                                ToolTip="{Binding DisplayText}">
                                <Run Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="{Binding DisplayName, Mode=OneWay}" /><Run Foreground="{DynamicResource TextFillColorTertiaryBrush}" Text="{Binding BranchName, Mode=OneWay, StringFormat=' ({0})', TargetNullValue=''}" /><Run Foreground="#F59E0B" Text="{Binding IsDetached, Mode=OneWay, Converter={StaticResource BoolToDetachedTextConverter}}" />
                            </TextBlock>

                            <!--  Right-side indicators (always visible)  -->
                            <StackPanel
                                Grid.Column="3"
                                Margin="4,0,0,0"
                                VerticalAlignment="Center"
                                Orientation="Horizontal">
                                <!--  Main worktree badge  -->
                                <Border
                                    Padding="4,1"
                                    Background="{DynamicResource LeafAccentSubtleBrush}"
                                    CornerRadius="6"
                                    ToolTip="Main worktree"
                                    Visibility="{Binding IsMainWorktree, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock
                                        FontSize="9"
                                        FontWeight="SemiBold"
                                        Foreground="#3B82F6"
                                        Text="MAIN" />
                                </Border>

                                <!--  Lock indicator  -->
                                <ic:SymbolIcon
                                    Margin="4,0,0,0"
                                    FontSize="10"
                                    Foreground="#F59E0B"
                                    IconVariant="Filled"
                                    Symbol="LockClosed"
                                    ToolTip="{Binding LockReason, TargetNullValue='Locked'}"
                                    Visibility="{Binding IsLocked, Converter={StaticResource BoolToVisibilityConverter}}" />
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </TreeView.Resources>

            <TreeView.ItemContainerStyle>
                <!--  Uses custom template with DataContext.IsSelected for multi-select visual  -->
                <!--  This allows showing the same branch as selected in both GITFLOW and LOCAL  -->
                <Style BasedOn="{StaticResource MultiSelectBranchTreeViewItemStyle}" TargetType="TreeViewItem">
                    <Setter Property="Padding" Value="2" />
                </Style>
            </TreeView.ItemContainerStyle>
        </TreeView>

        <!--  GitFlow Quick Create Flyout  -->
        <Popup
            x:Name="QuickCreatePopup"
            AllowsTransparency="True"
            Placement="Right"
            PopupAnimation="Fade"
            StaysOpen="False">
            <Border
                MinWidth="240"
                MaxWidth="300"
                Padding="12"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="6">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="16"
                        Opacity="0.3"
                        ShadowDepth="4" />
                </Border.Effect>
                <StackPanel>
                    <!--  Header  -->
                    <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                        <Border
                            x:Name="QuickCreateTypeIndicator"
                            Width="8"
                            Height="8"
                            Margin="0,0,6,0"
                            VerticalAlignment="Center"
                            CornerRadius="4" />
                        <TextBlock
                            x:Name="QuickCreateHeader"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Text="Start Feature" />
                    </StackPanel>

                    <!--  Name Input  -->
                    <TextBox
                        x:Name="QuickCreateNameBox"
                        Padding="8,6"
                        FontSize="12"
                        KeyDown="QuickCreateNameBox_KeyDown"
                        TextChanged="QuickCreateNameBox_TextChanged" />

                    <!--  Branch Preview  -->
                    <TextBlock
                        x:Name="QuickCreatePreview"
                        Margin="2,4,0,0"
                        FontFamily="Consolas"
                        FontSize="10"
                        Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                        TextTrimming="CharacterEllipsis" />

                    <!--  Suggested Version (for release/hotfix)  -->
                    <StackPanel
                        x:Name="QuickCreateVersionPanel"
                        Margin="0,6,0,0"
                        Orientation="Horizontal"
                        Visibility="Collapsed">
                        <TextBlock
                            Margin="0,0,6,0"
                            VerticalAlignment="Center"
                            FontSize="10"
                            Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                            Text="Suggested:" />
                        <Button
                            x:Name="QuickCreateVersionButton"
                            Padding="6,2"
                            Background="{DynamicResource ControlFillColorDefaultBrush}"
                            Click="QuickCreateVersionButton_Click">
                            <TextBlock x:Name="QuickCreateVersionText" FontSize="10" />
                        </Button>
                    </StackPanel>

                    <!--  Buttons  -->
                    <StackPanel
                        Margin="0,10,0,0"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal">
                        <Button
                            Padding="10,4"
                            Click="QuickCreateCancel_Click"
                            Content="Cancel"
                            FontSize="11" />
                        <Button
                            x:Name="QuickCreateStartButton"
                            Margin="6,0,0,0"
                            Padding="12,4"
                            Background="{DynamicResource AccentFillColorDefaultBrush}"
                            Click="QuickCreateStart_Click"
                            Content="Start"
                            FontSize="11"
                            Foreground="White"
                            IsEnabled="False" />
                    </StackPanel>

                    <!--  Progress  -->
                    <StackPanel
                        x:Name="QuickCreateProgress"
                        Margin="0,8,0,0"
                        Visibility="Collapsed">
                        <ProgressBar Height="2" IsIndeterminate="True" />
                        <TextBlock
                            x:Name="QuickCreateProgressText"
                            Margin="0,4,0,0"
                            FontSize="10"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="Creating branch..." />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>

        <!--  Worktree Create Popup  -->
        <Popup
            x:Name="WorktreeCreatePopup"
            AllowsTransparency="True"
            Placement="Right"
            PopupAnimation="Fade"
            StaysOpen="False">
            <Border
                MinWidth="280"
                MaxWidth="350"
                Padding="12"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="6">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="16"
                        Opacity="0.3"
                        ShadowDepth="4" />
                </Border.Effect>
                <StackPanel>
                    <!--  Header  -->
                    <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                        <ic:SymbolIcon
                            Margin="0,0,6,0"
                            VerticalAlignment="Center"
                            FontSize="14"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Symbol="TreeDeciduous" />
                        <TextBlock
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Text="Create Worktree" />
                    </StackPanel>

                    <!--  Description  -->
                    <TextBlock
                        Margin="0,0,0,8"
                        FontSize="11"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Text="Create a new worktree with a new branch:"
                        TextWrapping="Wrap" />

                    <!--  Branch Name Input  -->
                    <TextBox
                        x:Name="WorktreeNameBox"
                        Padding="8,6"
                        FontSize="12"
                        KeyDown="WorktreeNameBox_KeyDown"
                        TextChanged="WorktreeNameBox_TextChanged" />

                    <!--  Path Preview  -->
                    <TextBlock
                        x:Name="WorktreePathPreview"
                        Margin="2,4,0,0"
                        FontFamily="Consolas"
                        FontSize="10"
                        Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                        Text="Path: ..."
                        TextTrimming="CharacterEllipsis" />

                    <!--  Buttons  -->
                    <StackPanel
                        Margin="0,12,0,0"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal">
                        <Button
                            Padding="10,4"
                            Click="WorktreeCreateCancel_Click"
                            Content="Cancel"
                            FontSize="11" />
                        <Button
                            x:Name="WorktreeCreateButton"
                            Margin="6,0,0,0"
                            Padding="12,4"
                            Background="{DynamicResource AccentFillColorDefaultBrush}"
                            Click="WorktreeCreateConfirm_Click"
                            Content="Create"
                            FontSize="11"
                            Foreground="White"
                            IsEnabled="False" />
                    </StackPanel>

                    <!--  Progress  -->
                    <StackPanel
                        x:Name="WorktreeCreateProgress"
                        Margin="0,8,0,0"
                        Visibility="Collapsed">
                        <ProgressBar Height="2" IsIndeterminate="True" />
                        <TextBlock
                            x:Name="WorktreeCreateProgressText"
                            Margin="0,4,0,0"
                            FontSize="10"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="Creating worktree..." />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>

        <!--  Branch Create/Rename Popup  -->
        <Popup
            x:Name="BranchCreatePopup"
            AllowsTransparency="True"
            Placement="Right"
            PopupAnimation="Fade"
            StaysOpen="False"
            Closed="BranchCreatePopup_Closed">
            <Border
                MinWidth="280"
                MaxWidth="350"
                Padding="12"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="6">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="16"
                        Opacity="0.3"
                        ShadowDepth="4" />
                </Border.Effect>
                <StackPanel>
                    <!--  Header  -->
                    <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                        <ic:SymbolIcon
                            Margin="0,0,6,0"
                            VerticalAlignment="Center"
                            FontSize="14"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Symbol="BranchFork" />
                        <TextBlock
                            x:Name="BranchCreateHeader"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Text="Create Branch" />
                    </StackPanel>

                    <!--  Description  -->
                    <TextBlock
                        x:Name="BranchCreateDescription"
                        Margin="0,0,0,8"
                        FontSize="11"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Text="Enter a name for the new branch:"
                        TextWrapping="Wrap" />

                    <!--  Branch Name Input  -->
                    <TextBox
                        x:Name="BranchNameBox"
                        Padding="8,6"
                        FontSize="12"
                        KeyDown="BranchNameBox_KeyDown"
                        PreviewTextInput="BranchNameBox_PreviewTextInput"
                        TextChanged="BranchNameBox_TextChanged" />

                    <!--  Buttons  -->
                    <StackPanel
                        Margin="0,12,0,0"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal">
                        <Button
                            Padding="10,4"
                            Click="BranchCreateCancel_Click"
                            Content="Cancel"
                            FontSize="11" />
                        <Button
                            x:Name="BranchCreateButton"
                            Margin="6,0,0,0"
                            Padding="12,4"
                            Background="{DynamicResource AccentFillColorDefaultBrush}"
                            Click="BranchCreateConfirm_Click"
                            Content="Create"
                            FontSize="11"
                            Foreground="White"
                            IsEnabled="False" />
                    </StackPanel>

                    <!--  Progress  -->
                    <StackPanel
                        x:Name="BranchCreateProgress"
                        Margin="0,8,0,0"
                        Visibility="Collapsed">
                        <ProgressBar Height="2" IsIndeterminate="True" />
                        <TextBlock
                            x:Name="BranchCreateProgressText"
                            Margin="0,4,0,0"
                            FontSize="10"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="Creating branch..." />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</UserControl>
