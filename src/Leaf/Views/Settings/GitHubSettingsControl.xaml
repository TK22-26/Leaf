<UserControl
    x:Class="Leaf.Views.Settings.GitHubSettingsControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ic="clr-namespace:FluentIcons.Wpf;assembly=FluentIcons.Wpf">

    <StackPanel>
        <TextBlock Text="GitHub"
                   FontSize="18"
                   FontWeight="SemiBold"
                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                   Margin="0,0,0,4" />
        <TextBlock Text="Connect to GitHub for private repository access"
                   FontSize="12"
                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                   Margin="0,0,0,16" />

        <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16">
            <StackPanel>
                <!-- OAuth Section -->
                <Border x:Name="GitHubOAuthSection"
                        Background="{DynamicResource ControlFillColorDefaultBrush}"
                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Avatar (shown when connected via OAuth) -->
                        <Border x:Name="GitHubOAuthAvatar"
                                Width="40" Height="40"
                                CornerRadius="20"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                Margin="0,0,12,0"
                                Visibility="Collapsed">
                            <Grid>
                                <Grid.Clip>
                                    <EllipseGeometry Center="19,19" RadiusX="19" RadiusY="19" />
                                </Grid.Clip>
                                <Image x:Name="GitHubOAuthIdenticonImage" Stretch="UniformToFill" />
                                <Image x:Name="GitHubOAuthAvatarImage" Stretch="UniformToFill" />
                            </Grid>
                        </Border>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <ic:SymbolIcon Symbol="Person" FontSize="16" Margin="0,0,8,0" />
                                <TextBlock Text="Sign in with GitHub"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"
                                           Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                                <Border Background="{DynamicResource AccentFillColorDefaultBrush}"
                                        CornerRadius="4"
                                        Padding="6,2"
                                        Margin="8,0,0,0">
                                    <TextBlock Text="Recommended"
                                               FontSize="10"
                                               Foreground="White" />
                                </Border>
                            </StackPanel>
                            <TextBlock x:Name="GitHubOAuthStatusText"
                                       Text="Securely authenticate using your browser"
                                       FontSize="11"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       Margin="24,4,0,0" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button x:Name="GitHubOAuthButton"
                                    Padding="16,8"
                                    Click="GitHubOAuth_Click"
                                    Content="Sign in" />
                            <Button x:Name="GitHubOAuthDisconnectButton"
                                    Padding="12,6"
                                    Margin="8,0,0,0"
                                    Click="GitHubDisconnect_Click"
                                    Content="Disconnect"
                                    Visibility="Collapsed" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- PAT Section -->
                <Border x:Name="GitHubPatSection"
                        Background="{DynamicResource ControlFillColorDefaultBrush}"
                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12">
                    <StackPanel>
                        <!-- PAT Header -->
                        <Grid Margin="0,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Avatar (shown when connected via PAT) -->
                            <Border x:Name="GitHubPatAvatar"
                                    Width="40" Height="40"
                                    CornerRadius="20"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    Margin="0,0,12,0"
                                    Visibility="Collapsed">
                                <Grid>
                                    <Grid.Clip>
                                        <EllipseGeometry Center="19,19" RadiusX="19" RadiusY="19" />
                                    </Grid.Clip>
                                    <Image x:Name="GitHubPatIdenticonImage" Stretch="UniformToFill" />
                                </Grid>
                            </Border>

                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <ic:SymbolIcon Symbol="Key" FontSize="16" Margin="0,0,8,0" />
                                    <TextBlock Text="Personal Access Token"
                                               FontWeight="SemiBold"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                                </StackPanel>
                                <TextBlock x:Name="GitHubPatStatusText"
                                           Text="Use a PAT for authentication"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           Margin="24,4,0,0" />
                            </StackPanel>

                            <Button x:Name="GitHubPatDisconnectButton"
                                    Grid.Column="2"
                                    Padding="12,6"
                                    Click="GitHubDisconnect_Click"
                                    Content="Disconnect"
                                    Visibility="Collapsed" />
                        </Grid>

                        <!-- PAT Input Fields (shown when not connected via PAT) -->
                        <StackPanel x:Name="GitHubPatInputPanel" Margin="0,12,0,0">
                            <!-- PAT -->
                            <TextBlock Text="Personal Access Token"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       Margin="0,0,0,4" />
                            <TextBlock Text="Needs 'repo' scope (Full control of private repositories) for cloning, pushing, and pulling."
                                       FontSize="11"
                                       Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                       Margin="0,0,0,8"
                                       TextWrapping="Wrap" />
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <PasswordBox x:Name="GitHubPatPasswordBox"
                                             Grid.Column="0"
                                             Padding="8,6"
                                             PasswordChanged="GitHubPatPasswordBox_PasswordChanged" />
                                <Button x:Name="ToggleGitHubPatVisibilityButton"
                                        Grid.Column="1"
                                        Width="60"
                                        Margin="8,0,0,0"
                                        Click="ToggleGitHubPatVisibility_Click"
                                        Content="Show" />
                            </Grid>
                            <TextBox x:Name="GitHubPatTextBox"
                                     Margin="0,0,0,8"
                                     Padding="8,6"
                                     TextChanged="GitHubPatTextBox_TextChanged"
                                     Visibility="Collapsed" />

                            <!-- PAT Connect Button -->
                            <Button x:Name="SaveGitHubPatButton"
                                    Padding="12,6"
                                    Click="SaveGitHubPat_Click"
                                    Content="Connect" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- OAuth Flow Panel (shown during authorization) -->
                <StackPanel x:Name="GitHubOAuthFlowPanel" Visibility="Collapsed">
                    <TextBlock Text="Complete authorization in your browser"
                               FontWeight="SemiBold"
                               FontSize="14"
                               Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                               Margin="0,0,0,16" />

                    <!-- User Code Display -->
                    <TextBlock Text="Your verification code:"
                               FontSize="12"
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                               Margin="0,0,0,8" />
                    <Border Background="{DynamicResource ControlFillColorDefaultBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20,12"
                            HorizontalAlignment="Left">
                        <TextBlock x:Name="GitHubUserCodeText"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   FontFamily="Consolas"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                   Text="XXXX-XXXX" />
                    </Border>
                    <Button x:Name="GitHubCopyCodeButton"
                            Margin="0,8,0,0"
                            Padding="12,6"
                            HorizontalAlignment="Left"
                            Click="GitHubCopyCode_Click">
                        <StackPanel Orientation="Horizontal">
                            <ic:SymbolIcon Symbol="Copy" FontSize="14" Margin="0,0,6,0" />
                            <TextBlock Text="Copy Code" />
                        </StackPanel>
                    </Button>

                    <!-- Instructions -->
                    <StackPanel Margin="0,20,0,0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="1. Go to "
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                            <TextBlock x:Name="GitHubVerificationUriText"
                                       Text="https://github.com/login/device"
                                       Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"
                                       TextDecorations="Underline"
                                       Cursor="Hand"
                                       MouseDown="GitHubVerificationUri_Click" />
                        </StackPanel>
                        <TextBlock Text="2. Enter the code above and authorize Leaf"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                    </StackPanel>

                    <!-- Progress -->
                    <ProgressBar x:Name="GitHubOAuthProgressBar"
                                 IsIndeterminate="True"
                                 Margin="0,20,0,0" />
                    <TextBlock x:Name="GitHubOAuthStatusMessage"
                               FontSize="11"
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                               Margin="0,8,0,0"
                               Text="Waiting for authorization..." />

                    <!-- Cancel -->
                    <Button x:Name="GitHubCancelOAuthButton"
                            Margin="0,16,0,0"
                            Padding="12,6"
                            Click="GitHubCancelOAuth_Click"
                            Content="Cancel" />
                </StackPanel>
            </StackPanel>
        </Border>
    </StackPanel>
</UserControl>
