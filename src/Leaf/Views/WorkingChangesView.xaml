<UserControl
    x:Class="Leaf.Views.WorkingChangesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Leaf.Converters"
    xmlns:controls="clr-namespace:Leaf.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ic="clr-namespace:FluentIcons.Wpf;assembly=FluentIcons.Wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="600"
    d:DesignWidth="350"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BoolToSectionRowHeightConverter x:Key="BoolToSectionRowHeightConverter" />
    </UserControl.Resources>

    <Grid x:Name="WorkingChangesRoot">
        <Grid.RowDefinitions>
            <!-- Top Banner -->
            <RowDefinition Height="35" />
            <!-- Unstaged files -->
            <RowDefinition Height="{Binding IsUnstagedExpanded, Converter={StaticResource BoolToSectionRowHeightConverter}}" />
            <!-- Staged files -->
            <RowDefinition Height="{Binding IsStagedExpanded, Converter={StaticResource BoolToSectionRowHeightConverter}}" />
            <!-- Commit section -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Top Banner -->
        <Border
            Grid.Row="0"
            Padding="8"
            Background="{DynamicResource ControlFillColorTertiaryBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Discard All Button (trashcan icon) -->
                <Button
                    Grid.Column="0"
                    Margin="-4"
                    Padding="6,4"
                    VerticalAlignment="Stretch"
                    Background="Transparent"
                    BorderThickness="0"
                    Command="{Binding DiscardAllCommand}"
                    ToolTip="Discard all changes">
                    <ic:SymbolIcon
                        FontSize="14"
                        Foreground="#E81123"
                        Symbol="Delete" />
                </Button>

                <!-- File changes summary -->
                <TextBlock
                    Grid.Column="1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    FontSize="12"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Text="{Binding FileChangesSummary, Mode=OneWay}" />
            </Grid>
        </Border>

        <!-- Unstaged Files Section -->
        <controls:FileChangesSectionControl
            Grid.Row="1"
            Margin="8,8,8,0"
            Context="{Binding UnstagedSectionContext}"
            IsExpanded="{Binding IsUnstagedExpanded, Mode=TwoWay}"
            ItemCount="{Binding WorkingChanges.UnstagedFiles.Count, Mode=OneWay, FallbackValue=0}"
            ShowTreeView="{Binding ShowUnstagedTreeView, Mode=TwoWay}" />

        <!-- Staged Files Section -->
        <controls:FileChangesSectionControl
            Grid.Row="2"
            Margin="8,0"
            Context="{Binding StagedSectionContext}"
            IsExpanded="{Binding IsStagedExpanded, Mode=TwoWay}"
            ItemCount="{Binding WorkingChanges.StagedFiles.Count, Mode=OneWay, FallbackValue=0}"
            ShowTreeView="{Binding ShowStagedTreeView, Mode=TwoWay}" />

        <!-- Commit Section -->
        <controls:CommitInputControl
            Grid.Row="3"
            Margin="8"
            AutoFillCommand="{Binding AutoFillCommitMessageCommand}"
            CanCommit="{Binding CanCommit}"
            CommitCommand="{Binding CommitCommand}"
            CommitDescription="{Binding CommitDescription, Mode=TwoWay}"
            CommitMessage="{Binding CommitMessage, Mode=TwoWay}"
            IsAiAvailable="{Binding IsAiAvailable}"
            IsLoading="{Binding IsLoading}"
            RemainingChars="{Binding RemainingChars}" />
    </Grid>
</UserControl>
