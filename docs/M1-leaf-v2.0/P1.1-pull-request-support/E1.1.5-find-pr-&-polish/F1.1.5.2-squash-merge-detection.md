---
title: Squash-merge Detection
status: planned
owner: TBD
start_date: asap
duration: 0.5d
story_points: 3
depends_on: []
follows: []
---

# F1.1.5.2: Squash-merge Detection

**Description:**
Add fallback detection for squash-merged PRs by searching commit messages for PR number patterns (#123).

**Technical Approach:**

1. When FindPullRequestsForCommitAsync returns empty:
   - Parse commit message for patterns: (#123), (closes #123), (fixes #123)
   - Extract PR number(s) from matches

2. For each extracted number (max 3 to limit API calls):
   - Call GetPullRequestAsync
   - Filter to only merged PRs that match timeframe

3. Return found PRs or empty list
## Business Value

- **User Impact:** Find original PR even when commits were squash-merged; complete commit history traceability
- **Technical Value:** Message pattern matching extracts PR numbers; limits API calls to avoid rate limiting

## Inputs & Outputs

| Name | Type | Nullable | Description |
|:-----|:-----|:---------|:------------|
|  |  |  |  |

**Returns:** void - No return value

## Edge Cases & Boundary Conditions

| ID | Condition | Expected Behavior |
|:---|:----------|:------------------|
| EC-1 | No PR number in commit message | Return empty list |
| EC-2 | Multiple PR numbers (#123, #456) | Check first 3 max to limit API calls |
| EC-3 | PR number exists but is not merged | Filter out, only return merged PRs |
| EC-4 | PR number from different repo | Verify by checking PR data |

## Acceptance Criteria

### Functional
- [ ] Parse commit message for (#123), (closes #123), (fixes #123) patterns
- [ ] Extract PR numbers and call GetPullRequestAsync for each (max 3)
- [ ] Filter to only merged PRs that match timeframe
- [ ] Return found PRs or empty list if none match

### Quality
- [ ] Max 3 API calls per commit to prevent rate limiting
- [ ] No compiler warnings

## Dependencies

| Type | ID/Name | Notes |
|:-----|:--------|:------|
| Depends On | None | |
| Blocks | None | |

## User Stories

### US-1: Find Squash-Merged PR

**User Story:**
> As a developer, I want to find the PR for a squash-merged commit so that I can see the original discussion.

**Acceptance Criteria:**
1. Given a squash-merge commit with "(#123)" in message, when I search, then PR #123 is found
2. Given a commit with multiple PR references, when I search, then only merged PRs matching timeframe return
3. Given a commit with no PR reference, when I search, then empty result returns

## Amendments

| Date | Category | Description | Rationale |
|:-----|:---------|:------------|:----------|

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
