---
title: MergePullRequestDialog & Merge
status: planned
owner: TBD
start_date: asap
duration: 1d
story_points: 5
depends_on: []
follows: []
---

# F1.1.4.1: MergePullRequestDialog & Merge

**Description:**
Create merge dialog with method selection (Merge/Squash/Rebase), optional commit message customization, and warnings for failing checks. Implement MergePullRequestAsync service method.

**Technical Approach:**

1. **MergePullRequestDialog.xaml:**
   - Merge method RadioButtons (Merge, Squash, Rebase)
   - Optional commit title/message TextBoxes (for squash/merge)
   - Warning section for failing checks or missing approvals
   - Merge/Cancel buttons

2. **GitHubPullRequestService.MergePullRequestAsync:**
   - PUT /repos/{owner}/{repo}/pulls/{number}/merge
   - Body: { merge_method: "merge"|"squash"|"rebase", commit_title?, commit_message? }
   - Handle 405 (not mergeable), 409 (conflict) with clear errors

3. **Return PullRequestMergeResult:**
   - Success, MergeSha on success
   - Error enum for NotMergeable, ChecksFailed, ReviewRequired, BranchProtection
## Business Value

- **User Impact:** Users can merge PRs with full control over merge method (merge/squash/rebase); warnings prevent merging with failing checks
- **Technical Value:** Proper error handling for all merge failure modes; PullRequestMergeResult type for structured responses

## Inputs & Outputs

| Name | Type | Nullable | Description |
|:-----|:-----|:---------|:------------|
|  |  |  |  |

**Returns:** void - No return value

## Edge Cases & Boundary Conditions

| ID | Condition | Expected Behavior |
|:---|:----------|:------------------|
| EC-1 | PR not mergeable (conflicts) | Show warning, disable Merge button |
| EC-2 | Status checks failing | Show warning with check names, allow merge with confirmation |
| EC-3 | Required reviews missing | Show warning, allow merge with confirmation |
| EC-4 | Branch protection blocks merge | Show clear error from PullRequestMergeResult |
| EC-5 | Rebase not allowed by repo | Disable rebase option in dialog |

## Acceptance Criteria

### Functional
- [ ] Dialog shows merge method options: Merge, Squash, Rebase
- [ ] Optional commit title/message fields for squash/merge
- [ ] Warning section displays failing checks and missing approvals
- [ ] Merge button calls MergePullRequestAsync with selected method
- [ ] Success shows merge SHA, refreshes PR list
- [ ] Failure shows clear error message from PullRequestMergeResult

### Quality
- [ ] Loading state during merge operation
- [ ] Error messages actionable and clear
- [ ] No compiler warnings

## Dependencies

| Type | ID/Name | Notes |
|:-----|:--------|:------|
| Depends On | None | |
| Blocks | None | |

## User Stories

### US-1: Merge Pull Request

**User Story:**
> As a developer, I want to merge a PR from Leaf so that I can complete the review workflow without switching to browser.

**Acceptance Criteria:**
1. Given an approved PR, when I click Merge, then merge dialog opens with method options
2. Given I select "Squash" and enter commit message, when I click Merge, then PR is squash-merged with custom message
3. Given merge succeeds, when dialog closes, then PR list refreshes and shows PR as merged

### US-2: Merge Warnings

**User Story:**
> As a developer, I want to see warnings before merging so that I don't accidentally merge PRs with problems.

**Acceptance Criteria:**
1. Given PR has failing checks, when merge dialog opens, then I see check names with failure state
2. Given PR lacks required approvals, when merge dialog opens, then I see approval warning
3. Given I proceed with warnings, when I click Merge, then merge attempt proceeds

## Amendments

| Date | Category | Description | Rationale |
|:-----|:---------|:------------|:----------|

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
