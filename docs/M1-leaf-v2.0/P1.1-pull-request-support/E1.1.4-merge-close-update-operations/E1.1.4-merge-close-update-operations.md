---
title: Merge/Close/Update Operations
status: planned
owner: TBD
start_date: asap
duration: 2.5d
story_points: 13
depends_on: []
follows: []
---

# E1.1.4: Merge/Close/Update Operations

**Current State:** Users can view PRs but cannot merge, close, or update them from Leaf.

**Target State:** Complete PR lifecycle operations including merge (with method selection), close, update (title/body/draft), and status checks display.

**Business Value:** Full PR management workflow in Leaf; maintainers can merge approved PRs without browser.
## Critical Files

**Modify:**
- src/Leaf/Services/GitHubPullRequestService.cs - Add MergePullRequestAsync, ClosePullRequestAsync, UpdatePullRequestAsync
- src/Leaf/Services/IPullRequestService.cs - Add merge/close/update methods
- src/Leaf/ViewModels/PullRequestViewModel.cs - Add merge/close/update commands
- src/Leaf/Controls/PullRequestPanel.xaml - Add action buttons

**Create:**
- src/Leaf/Views/MergePullRequestDialog.xaml - Merge dialog with method selection
- src/Leaf/Views/MergePullRequestDialog.xaml.cs - Dialog code-behind
- src/Leaf/Models/PullRequestMergeResult.cs - Merge result with error types

## Features

| Feature | Description | Story Points | Status |
|:--------|:------------|:-------------|:-------|
| [F1.1.4.1](F1.1.4.1-merge-pull-request-dialog-&-merge.md) | MergePullRequestDialog & Merge | 5 |  | Draft |
| [F1.1.4.2](F1.1.4.2-close-pr-implementation.md) | Close PR Implementation | 2 |  | Draft |
| [F1.1.4.3](F1.1.4.3-update-pr-implementation.md) | Update PR Implementation | 3 |  | Draft |
| [F1.1.4.4](F1.1.4.4-status-checks-display.md) | Status Checks Display | 3 |  | Draft |

## Implementation Order

1. **F1.1.4.1 MergePullRequestDialog** - Core merge functionality
2. **F1.1.4.2 Close PR** - Simple PATCH with state:closed
3. **F1.1.4.3 Update PR** - Title/body/draft toggle
4. **F1.1.4.4 Status Checks** - Display using HeadSha from PullRequestInfo

## Acceptance Criteria

### Functional
- [ ] Merge dialog shows method selection (merge/squash/rebase)
- [ ] Merge respects optional custom commit message
- [ ] Merge shows warnings for failing checks or missing approvals
- [ ] Close PR with confirmation dialog
- [ ] Update PR title/body via PATCH
- [ ] Update PR draft status via separate endpoints (GitHub-specific)
- [ ] Status checks display with pass/fail/pending icons

### Quality
- [ ] PullRequestMergeResult provides typed error information
- [ ] Error messages match provider API responses
- [ ] All tests passing

## Dependencies

**Depends on:** None
**Blocks:** None

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
