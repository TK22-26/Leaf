---
title: Update PR Implementation
status: planned
owner: TBD
start_date: asap
duration: 0.5d
story_points: 3
depends_on: []
follows: []
---

# F1.1.4.3: Update PR Implementation

**Description:**
Implement UpdatePullRequestAsync to modify PR title, body, and draft state. Handle GitHub's separate draft toggle endpoints.

**Technical Approach:**

1. **Title/Body Update:**
   - PATCH /repos/{owner}/{repo}/pulls/{number}
   - Body: { title?, body? }

2. **Draft Toggle (GitHub-specific - NOT via PATCH):**
   - Convert to draft: POST .../convert_to_draft
   - Ready for review: POST .../ready_for_review
   - Check current state first to avoid unnecessary calls

3. **Implementation:**
   ```csharp
   if (title != null || body != null)
       await PatchPullRequest(prNumber, title, body);

   if (isDraft.HasValue && currentPr.IsDraft != isDraft.Value)
   {
       var endpoint = isDraft.Value ? "convert_to_draft" : "ready_for_review";
       await PostDraftToggle(prNumber, endpoint);
   }
   ```
## Business Value

- **User Impact:** Edit PR title, description, and draft status without leaving Leaf
- **Technical Value:** GitHub draft toggle requires separate endpoints (not PATCH); handled transparently

## Inputs & Outputs

| Name | Type | Nullable | Description |
|:-----|:-----|:---------|:------------|
|  |  |  |  |

**Returns:** void - No return value

## Edge Cases & Boundary Conditions

| ID | Condition | Expected Behavior |
|:---|:----------|:------------------|
| EC-1 | Toggle draft when already in target state | Skip API call (check current state first) |
| EC-2 | Update title only (body unchanged) | Send PATCH with title only |
| EC-3 | Old GitHub without draft support | Skip draft toggle, log warning |
| EC-4 | Concurrent edit conflict | Show error, refresh PR data |

## Acceptance Criteria

### Functional
- [ ] Title update via PATCH works correctly
- [ ] Body update via PATCH works correctly
- [ ] Draft toggle uses separate endpoints (convert_to_draft / ready_for_review)
- [ ] Current draft state checked before toggle to avoid unnecessary calls
- [ ] PR details refresh after successful update

### Quality
- [ ] GitHub-specific draft behavior documented
- [ ] No compiler warnings

## Dependencies

| Type | ID/Name | Notes |
|:-----|:--------|:------|
| Depends On | None | |
| Blocks | None | |

## User Stories

### US-1: Edit PR Details

**User Story:**
> As a developer, I want to edit a PR's title and description so that I can clarify the change without using the browser.

**Acceptance Criteria:**
1. Given I edit the PR title, when I save, then PATCH updates the title on GitHub/Azure DevOps
2. Given I edit the PR description, when I save, then PATCH updates the body
3. Given I toggle draft status, when I save, then the correct endpoint is called (convert_to_draft or ready_for_review)

## Amendments

| Date | Category | Description | Rationale |
|:-----|:---------|:------------|:----------|

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
