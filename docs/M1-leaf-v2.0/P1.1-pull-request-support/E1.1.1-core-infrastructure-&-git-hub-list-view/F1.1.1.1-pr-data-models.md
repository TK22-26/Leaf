---
title: PR Data Models
status: planned
owner: TBD
start_date: asap
duration: 1d
story_points: 5
depends_on: []
follows: []
---

# F1.1.1.1: PR Data Models

**Description:**
Create all pull request domain models following existing Leaf patterns. Models must be provider-agnostic, thread-safe, and support UI binding where needed.

**Technical Approach:**

1. **PullRequestInfo.cs** with ObservableObject base:
   - Immutable API fields: Number, ProviderId, Title, Body, Author, AuthorEmail, AuthorAvatarUrl, SourceBranch, SourceBranchName, TargetBranch, TargetBranchName, HeadSha, BaseSha, RepoFullName, Status, IsDraft, CreatedAt, UpdatedAt, Url, Provider, CommitCount, CommentCount, AdditionsCount, DeletionsCount
   - Computed display: NumberDisplay, DateDisplay, AvatarKey
   - Observable: IsSelected (only this raises change notifications)
   - **Update Strategy:** Immutable data + replace-on-refresh (create new instance, don't mutate)
   - **Note:** IsDraft is separate from PullRequestStatus. PullRequestStatus.All is for filtering only, not a PR state.

2. **PullRequestFileInfo.cs:**
   - Path, OldPath (for renames), FileName (computed), Directory (computed)
   - Status (reuse FileChangeStatus), StatusIndicator (computed: +/M/-/R/C)
   - Additions, Deletions, IsBinary, Patch (nullable), HasPatch (computed)
   - IsDiffUnavailable (computed from IsBinary or missing Patch for large files)

3. **PullRequestReviewInfo.cs:**
   - ReviewId, Reviewer, ReviewerAvatarUrl, State (PullRequestReviewState), SubmittedAt, Body
   - PullRequestReviewState enum maps GitHub states and Azure DevOps votes

4. **PullRequestCommentInfo.cs:**
   - CommentId, ThreadId (for Azure DevOps), Author, AuthorAvatarUrl, Body, CreatedAt, UpdatedAt (nullable), FilePath (nullable for general comments), LineNumber (nullable), IsResolved
   - Computed: DateDisplay (follows CommitInfo pattern)

5. **PullRequestStatusCheckInfo.cs:**
   - Name, Context, State (PullRequestCheckState), Description, TargetUrl, CompletedAt (nullable)

6. **PullRequestMergeResult.cs:**
   - Success, Message, MergeSha, Error (PullRequestMergeError)

7. **Supporting Enums:**
   - `PullRequestStatus`: Open, Closed, Merged, All (All is filter-only)
   - `PullRequestReviewState`: Approved, ApprovedWithSuggestions, ChangesRequested, Commented, Pending, WaitingForAuthor, Dismissed
   - `PullRequestCheckState`: Pending, Success, Failure, Error, Cancelled
   - `PullRequestMergeMethod`: Merge, Squash, Rebase
   - `PullRequestMergeError`: None, NotMergeable, ChecksFailed, ReviewRequired, BranchProtection, Conflict, Unknown
- **User Impact:** Foundation enabling all PR features - no direct user impact yet but required for everything that follows
- **Technical Value:** Clean domain model enabling provider abstraction; consistent patterns with existing codebase
## Inputs & Outputs

| Name | Type | Nullable | Description |
|:-----|:-----|:---------|:------------|
|  |  |  |  |

**Returns:** void - No return value

| ID | Condition | Expected Behavior |
|:---|:----------|:------------------|
| EC-1 | PR with null/empty body | Return empty string, not null |
| EC-2 | PR from fork (different head repo) | HeadSha populated correctly from head.sha |
| EC-3 | Binary file in PR | IsBinary=true, Patch=null, IsDiffUnavailable=true |
| EC-4 | Large file (>1MB) without patch | HasPatch=false, use content-based diff fallback |
| EC-5 | Azure DevOps vote values outside known range | Map to Pending (safe default) |
### Functional
- [ ] PullRequestInfo has all required fields: Number, ProviderId, Title, Body, Author, AuthorEmail, AuthorAvatarUrl, SourceBranch, SourceBranchName, TargetBranch, TargetBranchName, HeadSha, BaseSha, RepoFullName, Status, IsDraft, CreatedAt, UpdatedAt, Url, Provider, CommitCount, CommentCount, AdditionsCount, DeletionsCount
- [ ] PullRequestInfo.DateDisplay shows relative time (Just now, Xm ago, Xh ago, Xd ago, MMM d, MMM d yyyy)
- [ ] PullRequestInfo.AvatarKey computed for avatar caching
- [ ] PullRequestFileInfo has FileName, Directory, StatusIndicator, HasPatch computed properties
- [ ] PullRequestFileInfo.IsDiffUnavailable correctly identifies binary and large files
- [ ] PullRequestReviewInfo has all required fields: ReviewId, Reviewer, ReviewerAvatarUrl, State, SubmittedAt, Body
- [ ] PullRequestReviewState enum includes ApprovedWithSuggestions and WaitingForAuthor for Azure DevOps
- [ ] PullRequestCommentInfo has all required fields: CommentId, ThreadId, Author, AuthorAvatarUrl, Body, CreatedAt, UpdatedAt, FilePath, LineNumber, IsResolved
- [ ] PullRequestCommentInfo.DateDisplay computed property follows CommitInfo pattern
- [ ] PullRequestStatusCheckInfo has all required fields: Name, Context, State, Description, TargetUrl, CompletedAt
- [ ] PullRequestCheckState enum includes Cancelled state
- [ ] PullRequestMergeError enum has: None, NotMergeable, ChecksFailed, ReviewRequired, BranchProtection, Conflict, Unknown
- [ ] IsDraft is separate from PullRequestStatus (Status.All is filter-only, not a PR state)
- [ ] All models serializable (no provider-specific types exposed)

### Quality
- [ ] Follow CommitInfo.cs pattern for observable properties
- [ ] Use init-only properties for immutable API data (replace-on-refresh, don't mutate)
- [ ] Use [ObservableProperty] only for UI-interactive state (IsSelected)
- [ ] Include XML documentation on all public members
## Dependencies

| Type | ID/Name | Notes |
|:-----|:--------|:------|
| Depends On | None | |
| Blocks | None | |

### US-1: Domain Model Foundation

**User Story:**
> As a developer, I need well-defined PR domain models so that I can implement provider services and UI bindings with type safety.

**Acceptance Criteria:**
1. Given a GitHub PR API response, when I create a PullRequestInfo, then all fields map correctly including HeadSha from head.sha
2. Given an Azure DevOps PR response, when I create a PullRequestInfo, then HeadSha maps from lastMergeSourceCommit.commitId
3. Given a PullRequestInfo bound to UI, when selection changes, then only IsSelected property raises change notification
## Amendments

| Date | Category | Description | Rationale |
|:-----|:---------|:------------|:----------|

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
