---
title: PR Service Interface & Router
status: planned
owner: TBD
start_date: asap
duration: 0.5d
story_points: 3
depends_on: []
follows: []
---

# F1.1.1.2: PR Service Interface & Router

**Description:**
Define the provider-agnostic IPullRequestService interface and create PullRequestService that routes calls to the appropriate provider based on repository remote URL.

**Technical Approach:**
1. Create IPullRequestService.cs with all PR operations: IsPullRequestSupported, GetProviderType, ListPullRequestsAsync, GetPullRequestAsync, GetPullRequestFilesAsync, GetPullRequestCommitsAsync, GetPullRequestReviewsAsync, GetPullRequestCommentsAsync, GetPullRequestChecksAsync, CreatePullRequestAsync, MergePullRequestAsync, ClosePullRequestAsync, UpdatePullRequestAsync, FindPullRequestsForCommitAsync, CheckoutPullRequestAsync, GetPullRequestFileDiffAsync
2. Create PullRequestService.cs with constructor injection for IGitHubPullRequestService, IAzureDevOpsPullRequestService, IGitService
3. Implement GetProviderAndRemote() to detect provider from remote URL (github.com, dev.azure.com, visualstudio.com, /_git/ pattern)
4. Implement IsGitHubEnterpriseUrl() heuristic for custom GHE domains
5. Add provider preference: prefer "origin" remote, fall back to first supported remote
6. Delegate all interface methods to appropriate provider service
- **User Impact:** Single consistent API regardless of Git hosting provider; automatic provider detection
- **Technical Value:** Clean abstraction enabling future providers (GitLab, Bitbucket); testable via interface mocking
## Inputs & Outputs

| Name | Type | Nullable | Description |
|:-----|:-----|:---------|:------------|
|  |  |  |  |

**Returns:** void - No return value

| ID | Condition | Expected Behavior |
|:---|:----------|:------------------|
| EC-1 | Repo with no remotes | IsPullRequestSupported returns false |
| EC-2 | Repo with unsupported remote (GitLab) | IsPullRequestSupported returns false, GetProviderType returns Other |
| EC-3 | Repo with multiple remotes (origin=GitHub, upstream=Azure) | Prefer origin remote |
| EC-4 | GitHub Enterprise custom domain | IsGitHubEnterpriseUrl heuristic detects correctly |
| EC-5 | Azure DevOps Server on-prem | Detected by /_git/ path pattern |
| EC-6 | SSH URL format (git@...) | Parsed correctly for both providers |
### Functional
- [ ] IPullRequestService defines all 16 methods covering all PR operations
- [ ] All methods accept CancellationToken for cancellation support
- [ ] PullRequestService correctly routes github.com URLs to GitHub provider
- [ ] PullRequestService correctly routes dev.azure.com URLs to Azure provider
- [ ] PullRequestService correctly routes visualstudio.com URLs to Azure provider
- [ ] PullRequestService prefers "origin" remote over other remotes
- [ ] IsPullRequestSupported returns false for GitLab, Bitbucket, local-only repos

### Quality
- [ ] Constructor injection for all dependencies (no internal instantiation)
- [ ] No direct HTTP calls in router (delegates to provider services)
- [ ] Interface documented with XML comments
## Dependencies

| Type | ID/Name | Notes |
|:-----|:--------|:------|
| Depends On | None | |
| Blocks | None | |

### US-1: Transparent Provider Routing

**User Story:**
> As a user with both GitHub and Azure DevOps repositories, I want PR features to work automatically based on my remote URL without manual configuration.

**Acceptance Criteria:**
1. Given a repo with github.com origin, when I open PR panel, then GitHub provider is used automatically
2. Given a repo with dev.azure.com origin, when I open PR panel, then Azure DevOps provider is used automatically
3. Given a repo with no supported remotes, when I open PR panel, then "PR not supported" message displays
4. Given a repo with multiple remotes, when I open PR panel, then origin is preferred
## Amendments

| Date | Category | Description | Rationale |
|:-----|:---------|:------------|:----------|

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
