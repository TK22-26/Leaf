---
title: CreatePullRequestDialog
status: planned
owner: TBD
start_date: asap
duration: 1d
story_points: 5
depends_on: []
follows: []
---

# F1.1.3.1: CreatePullRequestDialog

**Description:**
Create a dialog window for creating new pull requests with title input, branch selection dropdowns, description textarea, and draft checkbox. Implement CreatePullRequestAsync service method.

**Technical Approach:**

1. **CreatePullRequestDialogViewModel.cs:**
   - Properties: Title, Description, SourceBranches, TargetBranches, SelectedSourceBranch, SelectedTargetBranch, IsDraft, CanCreate, ValidationError, IsCreating
   - Validation: Title required, source != target branch
   - CreateCommand: Call service, close dialog on success

2. **CreatePullRequestDialog.xaml:**
   - Title TextBox with placeholder
   - Branch selection: source ComboBox ΓåÆ arrow ΓåÆ target ComboBox
   - Description TextBox with AcceptsReturn, TextWrapping
   - Draft CheckBox
   - Cancel/Create buttons

3. **GitHubPullRequestService.CreatePullRequestAsync:**
   - POST /repos/{owner}/{repo}/pulls
   - Body: { title, body, head: sourceBranch, base: targetBranch, draft: true/false }

4. **Default Selections:**
   - Source: current local branch
   - Target: main/master/develop (first found)
## Business Value

- **User Impact:** Users can create PRs directly from Leaf without switching to browser; smart branch defaults save time
- **Technical Value:** Standard dialog pattern; validation prevents common mistakes; draft support for WIP PRs

## Inputs & Outputs

| Name | Type | Nullable | Description |
|:-----|:-----|:---------|:------------|
|  |  |  |  |

**Returns:** void - No return value

## Edge Cases & Boundary Conditions

| ID | Condition | Expected Behavior |
|:---|:----------|:------------------|
| EC-1 | Empty title | Disable Create button, show validation error |
| EC-2 | Source branch = target branch | Disable Create button, show "Select different branches" |
| EC-3 | No remote tracking branch | Warn user that push is required first |
| EC-4 | Draft PR not supported (old GitHub) | Hide draft checkbox, create regular PR |
| EC-5 | API returns validation error | Show error message, keep dialog open |

## Acceptance Criteria

### Functional
- [ ] Dialog opens with title, description, branch dropdowns, draft checkbox
- [ ] Source branch defaults to current local branch
- [ ] Target branch defaults to main/master/develop (first found)
- [ ] Create button disabled until title entered and branches different
- [ ] Draft checkbox creates draft PR when checked
- [ ] Successful creation closes dialog and refreshes PR list
- [ ] API errors display in dialog without closing

### Quality
- [ ] Validation messages are clear and actionable
- [ ] Loading state shown during API call
- [ ] No compiler warnings

## Dependencies

| Type | ID/Name | Notes |
|:-----|:--------|:------|
| Depends On | None | |
| Blocks | None | |

## User Stories

### US-1: Create Pull Request

**User Story:**
> As a developer, I want to create a pull request from Leaf so that I don't have to switch to the browser.

**Acceptance Criteria:**
1. Given I click "Create PR", when dialog opens, then my current branch is pre-selected as source
2. Given I enter a title and select branches, when I click Create, then PR is created on GitHub/Azure DevOps
3. Given I check "Draft", when PR is created, then it's marked as draft on the provider

### US-2: Branch Validation

**User Story:**
> As a developer, I want to be prevented from creating invalid PRs so that I don't waste time.

**Acceptance Criteria:**
1. Given I leave title empty, when I try to create, then Create button is disabled
2. Given I select same branch for source and target, when I try to create, then I see validation error

## Amendments

| Date | Category | Description | Rationale |
|:-----|:---------|:------------|:----------|

## Proposed Improvements

<!-- Document opportunities for refactoring, scope adjustments, or better engineering practices here. Do not implement yet; just log them. When a proposed improvement affects work above this item's level, document it in the appropriate ancestor. -->

| ID | Description | Resolution |
|:---|:------------|:-----------|
