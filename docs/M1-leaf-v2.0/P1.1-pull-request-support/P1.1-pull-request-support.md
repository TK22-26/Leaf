---
title: Pull Request Support
status: planned
owner: TBD
start_date: asap
duration: 22.25d
story_points: 89
depends_on: []
follows: []
---

Add comprehensive pull request support to Leaf for GitHub and Azure DevOps repositories. This enables users to view, create, update, merge, and manage pull requests directly within the application without switching to browser-based interfaces.

## Scope

**Providers:** GitHub (including Enterprise) and Azure DevOps (including Server)

**PR Features:**
- List and filter PRs (open, closed, merged, by author, search)
- View PR details (commits, files, diffs, reviews, comments, status checks)
- Create new PRs (with draft support)
- Update PRs (title, body, draft toggle)
- Merge PRs (merge, squash, rebase methods)
- Close PRs without merging
- Checkout PR branches locally
- Find PRs associated with commits

## Architecture Overview

- Add a provider-agnostic PR domain layer with provider-specific adapters
- Surface PRs in a dedicated `PullRequestPanel` control (separate from Diff/Blame/History viewer)
- Keep all provider access behind a single interface (`IPullRequestService`) for future extensibility
- Use dependency injection for all services to enable testing and avoid tight coupling

## Goals

1. Enable full PR workflow without leaving Leaf
2. Support both GitHub and Azure DevOps with unified interface
3. Integrate PR file diffs with existing DiffViewer
4. Maintain responsive UI with proper caching and lazy loading
5. Provide clear feedback for PR operations (merge, checkout, etc.)
6. Handle edge cases gracefully (forks, dirty working directory, rate limits)

## Critical Path

1. **E1.1.1 Core Infrastructure** -> Foundation for all other epics
2. **E1.1.2 PR Details** -> Depends on E1.1.1 models and services
3. **E1.1.3 Create PR** -> Depends on E1.1.1 services
4. **E1.1.4 Operations** -> Depends on E1.1.2 for status checks display
5. **E1.1.5 Find PR** -> Depends on E1.1.1 services
6. **E1.1.6 Azure DevOps** -> Parallel after E1.1.1, uses same interfaces
7. **E1.1.7 Polish** -> After all features complete

## Testing Requirements

### Manual Test Scenarios

| Scenario | GitHub | Azure DevOps |
|----------|--------|--------------|
| List open PRs | [x] | [x] |
| List closed/merged PRs | [x] | [x] |
| Search PRs by title | [x] | [x] |
| View PR details | [x] | [x] |
| View PR files with diff | [x] | [x] |
| View PR commits | [x] | [x] |
| View PR reviews/approvals | [x] | [x] |
| View PR comments | [x] | [x] |
| View status checks | [x] | [x] |
| Create PR (standard) | [x] | [x] |
| Create PR (draft) | [x] | [x] |
| Merge PR (merge/squash/rebase) | [x] | [x] |
| Close PR | [x] | [x] |
| Checkout PR locally | [x] | [x] |
| Fork PR checkout | [x] | [x] |
| Dirty working directory handling | [x] | [x] |
| PR with large file list (100+) | [x] | [x] |
| PR with many comments | [x] | [x] |
| No auth token error | [x] | [x] |
| Rate limit handling | [x] | N/A |

## Exit Criteria

- [ ] GitHub PRs: list, view, create, merge, close, update working
- [ ] Azure DevOps PRs: list, view, create, merge, close, update working
- [ ] PR file diffs display correctly in DiffViewer
- [ ] PR checkout handles forks and dirty working directory
- [ ] Find PR by commit works for both providers
- [ ] Caching reduces API calls without stale data issues
- [ ] All manual test scenarios pass for both providers
- [ ] No compiler warnings in new code

## File Structure

```
src/Leaf/
+-- Models/
|   +-- PullRequestInfo.cs
|   +-- PullRequestFileInfo.cs
|   +-- PullRequestReviewInfo.cs
|   +-- PullRequestCommentInfo.cs
|   +-- PullRequestStatusCheckInfo.cs
|   +-- PullRequestMergeResult.cs
+-- Services/
|   +-- IPullRequestService.cs
|   +-- PullRequestService.cs
|   +-- GitHubPullRequestService.cs
|   +-- AzureDevOpsPullRequestService.cs
+-- ViewModels/
|   +-- PullRequestViewModel.cs
|   +-- CreatePullRequestDialogViewModel.cs
+-- Controls/
|   +-- PullRequestPanel.xaml
|   +-- PullRequestPanel.xaml.cs
+-- Views/
    +-- CreatePullRequestDialog.xaml
    +-- CreatePullRequestDialog.xaml.cs
    +-- MergePullRequestDialog.xaml
    +-- MergePullRequestDialog.xaml.cs
```